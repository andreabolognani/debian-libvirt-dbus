From: =?utf-8?b?IkRhbmllbCBQLiBCZXJyYW5nw6ki?= <berrange@redhat.com>
Date: Tue, 22 Sep 2020 16:16:02 +0100
Subject: tests: skip CPU pinning test on libvirt 6.6.0
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: 8bit

This release broke the test driver making it depend on host CPU topology
instead of the fake CPU topology.

Signed-off-by: Daniel P. Berrang√© <berrange@redhat.com>
(cherry picked from commit e01a3cf5e60fa8f4d3bf9a805bfedbe5d5fa1507)

https://bugs.debian.org/971171
---
 tests/test_domain.py | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/tests/test_domain.py b/tests/test_domain.py
index 624d25b..7f67a3a 100755
--- a/tests/test_domain.py
+++ b/tests/test_domain.py
@@ -153,6 +153,13 @@ class TestDomain(libvirttest.BaseTestClass):
         assert domain.GetVcpus(0) == dbus.Int32(vcpus_expected)
 
     def test_domain_vcpu_pin_info(self):
+        # Test driver was broken in 6.6.0 accidentally depending
+        # on host CPU topology instead of its fake topology
+        obj = self.bus.get_object('org.libvirt', '/org/libvirt/Test')
+        ver = obj.Get('org.libvirt.Connect', "LibVersion", dbus_interface=dbus.PROPERTIES_IFACE)
+        if ver == 6006000:
+            return
+
         obj, domain = self.get_test_domain()
         pinInfo_expected = [
             [True, True, True, True, True, True, True, True],
